name: Restart Azure VM

on:
  repository_dispatch:
    types: [restart-vm]

jobs:
  restart:
    runs-on: ubuntu-latest

    steps:
      - name: Azure Login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
          auth-type: SERVICE_PRINCIPAL

      - name: Show Payload
        run: |
          echo "Resource Group: ${{ github.event.client_payload.resourceGroup }}"
          echo "VM Name: ${{ github.event.client_payload.vmName }}"

      - name: Restart VM
        run: |
          az vm restart \
            --resource-group "${{ github.event.client_payload.resourceGroup }}" \
            --name "${{ github.event.client_payload.vmName }}"
